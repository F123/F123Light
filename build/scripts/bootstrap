#!/bin/bash

export TEXTDOMAIN=pacstrap
export TEXTDOMAINDIR=./locale
#export TEXTDOMAINDIR=/usr/local/share/locale

. gettext.sh

. ./pacstrap.lib

set -e

directory=0

while getopts ':dhl:o:p:r:u:' flag
do
case $flag in
d)
directory=1
;;
h)
usage
exit 0
;;
l)
PACKAGELIST=${OPTARG}
;;
o)
HOSTNAME_=${OPTARG}
;;
p)
USERPWD=${OPTARG}
;;
r)
ROOTPWD=${OPTARG}
;;
u)
USERNAME=${OPTARG}
;;
:)
msg=$(gettext "Option requires an argument")
die '%s: %s -- '\''%s'\' "${0##*/}" "${msg}" "$OPTARG"
;;
?)
msg=$(gettext "Invalid option")
die '%s: %s -- '\''%s'\' "${0##*/}" "${msg}" "$OPTARG"
;;
esac
done

shift $(( OPTIND - 1 ))

(( $# )) || die "No root directory specified"

newroot=$1; shift

if (( directory )) ; then
	optiond='-d'
fi

# Install software to the new root
echo Installing ${PACKAGELIST}...
./pacstrap -l "${PACKAGELIST}" ${optiond} "${newroot}"

./config-base -o "${HOSTNAME_}" -r "${ROOTPWD}" -u "${USERNAME}" -p "${USERPWD}" -d "${newroot}"
